/**
 * ---------------------------------------------------------------------
 *
 * Powered by Urich Souza 
 *
 * https://github.com/nihilzin
 *
 * @copyright 2023 Urich Souza and contributors.
 * 
 * ---------------------------------------------------------------------
 */
var Reservations=function(){this.is_all=true;this.id=0;this.rand="";this.dom_id="";this.calendar=null;this.license_key=null;this.currentv=null;this.defaultDate=null;this.can_reserve=true;var e=this;e.init=function(t){e.id=t.id||0;e.is_all=t.is_all||true;e.rand=t.rand||true;e.is_tab=t.is_tab||false;e.license_key=t.license_key||"";e.dom_id="reservations_planning_"+e.rand;e.currentv=t.currentv||"dayGridMonth";e.defaultDate=t.defaultDate||new Date;e.defaultPDate=new Date(e.defaultDate);if(t.can_reserve!=undefined){e.can_reserve=t.can_reserve}};e.displayPlanning=function(){e.calendar=new FullCalendar.Calendar(document.getElementById(e.dom_id),{schedulerLicenseKey:e.license_key,timeZone:"UTC",nowIndicator:true,theme:true,editable:true,defaultDate:e.defaultDate,minTime:CFG_GLPI.planning_begin,maxTime:CFG_GLPI.planning_end,weekNumbers:true,defaultView:localStorage.getItem("fcDefaultViewReservation")!==null?localStorage.getItem("fcDefaultViewReservation"):e.currentv,height:function(){var t=$(window).height()-272;if($("#debugajax").length>0){t-=$("#debugajax").height()}if(e.is_tab){t=$(".glpi_tabs ").height()-150}var a=300;if(t<a){t=a}return t},resourceAreaWidth:"15%",plugins:["dayGrid","interaction","list","timeGrid","resourceTimeline"],header:{left:"prev,next,today",center:"title",right:"dayGridMonth, timeGridWeek, timeGridDay, listFull, resourceWeek"},views:{listFull:{type:"list",titleFormat:function(){return""},visibleRange:function(t){var a=t.getFullYear();var r=1;if(e.id>0){r=10}return{start:new Date(t.getTime()).setFullYear(a-r),end:new Date(t.getTime()).setFullYear(a+r)}}},resourceWeek:{type:"resourceTimeline",buttonText:__("Timeline Week"),duration:{weeks:1},groupByDateAndResource:true,slotLabelFormat:[{week:"short"},{weekday:"short",day:"numeric",month:"numeric",omitCommas:true},function(e){return e.date.hour}]}},events:{url:CFG_GLPI.root_doc+"/ajax/reservations.php",type:"GET",extraParams:{action:"get_events",reservationitems_id:e.id},success:function(){},failure:function(e){console.error("there was an error while fetching events!",e)}},resources:{url:CFG_GLPI.root_doc+"/ajax/reservations.php",method:"GET",extraParams:{action:"get_resources"}},eventRender:function(t){var a=t.event;var r=a.extendedProps;var n=$(t.el);var i=t.view;if("icon"in r&&!e.is_tab){var l="";if("icon_alt"in r){l=r.icon_alt}n.find(".fc-title, .fc-list-item-title").append("&nbsp;<i class='"+r.icon+"' title='"+l+"'></i>")}var s={target:"mouse",adjust:{mouse:false},viewport:$(window)};if(i.type.indexOf("list")>=0){s.target=n.find("a")}n.qtip({position:s,content:r.comment,style:{classes:"qtip-shadow qtip-bootstrap"},show:{solo:true,delay:100},hide:{fixed:true,delay:100}})},dayRender:function(t){if(e.dateAreSameDay(t.date,e.defaultPDate)){$(t.el).addClass("defaultDate")}},viewSkeletonRender:function(e){var t=e.view;localStorage.setItem("fcDefaultViewReservation",t.type)},eventResize:function(t){e.editEvent(t)},eventDrop:function(t){e.editEvent(t)},selectable:e.can_reserve,select:function(t){if(e.can_reserve){glpi_ajax_dialog({title:__("Add reservation"),url:CFG_GLPI.root_doc+"/ajax/reservations.php",params:{action:"add_reservation_fromselect",id:e.id,start:t.start.toISOString(),end:t.end.toISOString()},dialogclass:"modal-lg"})}e.calendar.unselect()},eventClick:function(e){var t=e.event;var a=t.extendedProps.ajaxurl;var r=t.extendedProps._editable;e.jsEvent.preventDefault();if(!r||!a){return}glpi_ajax_dialog({title:__("Edit reservation"),url:a+"&ajax=true",dialogclass:"modal-lg"})}});e.calendar.render();var t=Object.keys(FullCalendarLocales);if(t.length===1){e.calendar.setOption("locale",t[0])}};e.editEvent=function(e){var t=e.event;var a=e.revert;var r=t.start;var n=t.end;$.ajax({url:CFG_GLPI.root_doc+"/ajax/reservations.php",type:"POST",data:{action:"update_event",start:r.toISOString(),end:n.toISOString(),id:t.id},success:function(e){if(!e){a()}},error:function(){a()}})};e.dateAreSameDay=function(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}};