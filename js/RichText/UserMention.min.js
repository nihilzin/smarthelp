/**
 * ---------------------------------------------------------------------
 *
 * Powered by Urich Souza 
 *
 * https://github.com/nihilzin
 *
 * @copyright 2023 Urich Souza and contributors.
 * 
 * ---------------------------------------------------------------------
 */
var GLPI=GLPI||{};GLPI.RichText=GLPI.RichText||{};GLPI.RichText.UserMention=class{constructor(t,e,n){this.editor=t;this.activeEntity=e;this.idorToken=n}register(){const t=this;this.editor.ui.registry.addAutocompleter("user_mention",{ch:"@",minChars:0,fetch:function(e){return t.fetchItems(e)},onAction:function(e,n,i){t.mentionUser(e,n,i)}})}fetchItems(t){const e=this;return new Promise((function(n){$.post(CFG_GLPI.root_doc+"/ajax/getDropdownUsers.php",{entity_restrict:e.activeEntity,right:"all",display_emptychoice:0,searchText:t,_idor_token:e.idorToken}).done((function(t){const e=t.results.map((function(t){return{type:"autocompleteitem",value:JSON.stringify({id:t.id,name:t.text}),text:t.text}}));n(e)}))}))}mentionUser(t,e,n){const i=JSON.parse(n);this.editor.selection.setRng(e);this.editor.insertContent(this.generateUserMentionHtml(i));t.hide()}generateUserMentionHtml(t){return`<span contenteditable="false"\n                    data-user-mention="true"\n                    data-user-id="${t.id}">@${t.name}</span>&nbsp;`}};